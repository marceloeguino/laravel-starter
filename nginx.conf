# Set the user to run nginx worker processes (non-root for security)
# user  appuser;

# Automatically set the number of worker processes based on CPU cores
worker_processes  auto;

# Log errors to stderr at notice level
error_log  /dev/stderr notice;

# Store the nginx process ID in a temporary location (no root required)
pid        /tmp/nginx.pid;

events {
    # Maximum number of simultaneous connections per worker
    worker_connections 1024;
}

http {
    # Include MIME types for proper Content-Type headers
    include       mime.types;
    default_type  application/octet-stream;

    # Log access to stdout and errors to stderr
    access_log  /dev/stdout;
    error_log   /dev/stderr notice;

    # Enable efficient file transfers
    sendfile        on;
    # Keep connections alive for 65 seconds
    keepalive_timeout  65;

    server {
        listen 80;
        listen [::]:80;
        server_name _;
        root /var/www/html/public;

        add_header X-Frame-Options "SAMEORIGIN";
        add_header X-Content-Type-Options "nosniff";

        index index.php;

        charset utf-8;

        location / {
            try_files $uri $uri/ /index.php?$query_string;
        }

        location = /favicon.ico { access_log off; log_not_found off; }
        location = /robots.txt  { access_log off; log_not_found off; }

        error_page 404 /index.php;

        location ~ ^/index\.php(/|$) {
            fastcgi_pass 127.0.0.1:9000;
            fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
            include fastcgi_params;
            fastcgi_hide_header X-Powered-By;
        }

        location ~ /\.(?!well-known).* {
            deny all;
        }
    }
}
